<!DOCTYPE HTML>
<html>
<head>
 <meta charset="UTF-8">
 <title>Time Cube</title>
 <script type="text/javascript" src="timer.js"></script>
 <link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body></body>
<script type="text/javascript">
var storedState = localStorage.getItem('timer-state');

var thingy = Elm.Timer.fullscreen(storedState ? JSON.parse(storedState) : null);
// firefox 9.0.1 bugfix
window.onkeydown = function(event) {
	thingy.ports.keyupdown.send([event.keyCode, 0]);
};
window.onkeyup = function(event) {
	thingy.ports.keyupdown.send([0, event.keyCode]);
};

thingy.ports.setStorage.subscribe(function(state) {
    localStorage.setItem('timer-state', JSON.stringify(state));
});
thingy.ports.scrollBottom.subscribe(function(selector) {
	setTimeout(function() {
		var s = document.querySelector(selector);
		s.scrollTop = s.scrollHeight;
	}, 50);
});
var scrambleworker = new Worker("scramble.js");
thingy.ports.scrambleReq.subscribe(function({len, scrType: type}) {
	scrambleworker.postMessage({len, type});
});
scrambleworker.onmessage = ({data}) => {
	thingy.ports.scrambles.send(data.scramble);
};
</script>
</html>